(()=>{"use strict";const t=Math.floor,e=Math.min,s=Math.max,i=Math.round,n="---",h=["×1/32","×1/16","×1/8","×1/4","×1/2","×1","×2","×4","×8","×16","×32"],a=[1/32,1/16,1/8,1/4,.5,1,2,4,8,16,32],l=new class{constructor(t,e){this.init(t,e)}init(t,e,s){this.width=t,this.height=e,this.initializer=s,this.cells=new Array(t*e),this.buffer=new Array(t*e),this.reset()}reset(){if(this.cells.fill(0),this.initializer)for(const t of this.initializer)for(let e=0;e<this.cells.length;e+=t)this.cells[e]=1;this.ticks=0}getCell(t,e){return this.cells[e*this.width+t]}setCell(t,e,s){this.cells[e*this.width+t]=s}toggleCell(t,e){this.setCell(t,e,0===this.getCell(t,e)?1:0)}tick(){const t=this.width,e=this.height;for(let s=0;s<e;s++)for(let e=0;e<t;e++){const i=this.countNeighbours(e,s);1===this.getCell(e,s)?this.buffer[s*t+e]=2===i||3===i?1:0:this.buffer[s*t+e]=3===i?1:0}const s=this.cells;this.cells=this.buffer,this.buffer=s,this.ticks++}countNeighbours(t,e){const s=this.width,i=this.height,n=this.cells,h=(t+s-1)%s,a=(t+1)%s,l=(e+i-1)%i,o=(e+1)%i;return n[l*s+h]+n[l*s+t]+n[l*s+a]+n[e*s+h]+n[e*s+a]+n[o*s+h]+n[o*s+t]+n[o*s+a]}}(128,96),o=new class{constructor(t){this.game=t,this.canvas=document.getElementById("game-of-life-canvas"),this.canvas.addEventListener("click",(t=>this.onClick(t))),this.init()}init(){this.canvas.width=6*this.game.width-1,this.canvas.height=6*this.game.height-1,this.render()}render(){const t=this.canvas.getContext("2d");t.beginPath();const e=this.game.width,s=this.game.height;for(let i=0;i<s;i++){const s=6*i;for(let n=0;n<e;n++)t.fillStyle=0===this.game.getCell(n,i)?"#eeeeee":"#bb7733",t.fillRect(6*n,s,5,5)}t.stroke()}onClick(e){const s=this.canvas.getBoundingClientRect();this.game.toggleCell(t((e.clientX-s.left)/6),t((e.clientY-s.top)/6)),this.render()}}(l),d=new class{constructor(t,e){this.game=t,this.canvas=e,this.settings=document.getElementById("div-settings"),this.width=document.getElementById("settings-width"),this.width.value=t.width,this.height=document.getElementById("settings-height"),this.height.value=t.height,this.patterns=[2,3,5,7,11,13,17,19,23,29,31,37].map((t=>document.getElementById(`settings-pattern-${t}`))),this.settings.addEventListener("input",(t=>this.onInput(t))),this.apply()}disable(t){this.width.disabled=t,this.height.disabled=t;for(const e of this.patterns)e.disabled=t}setPlayer(t){this.player=t}onInput(t){const e=this.validateInput(this.width),s=this.validateInput(this.height);e&&s?(this.apply(),this.player&&this.player.onReset()):this.player&&this.player.disable()}validateInput(t){const e=Number(t.value),s=Number(t.min),i=Number(t.max);return e<s||e>i?(t.classList.add("invalid"),!1):(t.classList.remove("invalid"),!0)}apply(){this.game.init(Number(this.width.value),Number(this.height.value),this.patterns.filter((t=>t.checked)).map((t=>Number(t.name)))),this.canvas.init()}}(l,o),r=new class{constructor(t){this.game=t,this.steps=document.getElementById("monitor-steps"),this.fpsLatest=document.getElementById("monitor-fps-latest"),this.fpsAvg=document.getElementById("monitor-fps-avg"),this.fpsMin=document.getElementById("monitor-fps-min"),this.fpsMax=document.getElementById("monitor-fps-max"),this.reset()}reset(){this.fpsRec=[],this.steps.textContent=this.game.ticks,this.fpsLatest.textContent=n,this.fpsAvg.textContent=n,this.fpsMin.textContent=n,this.fpsMax.textContent=n,this.timeStamp=window.performance.now()}update(){const t=window.performance.now(),n=1e3/(t-this.timeStamp);this.timeStamp=t;const h=this.fpsRec;for(h.push(n);h.length>100;)h.shift();this.steps.textContent=this.game.ticks,this.fpsLatest.textContent=i(n),this.fpsAvg.textContent=i(h.reduce(((t,e)=>t+e),0)/h.length),this.fpsMin.textContent=i(e.apply(null,this.fpsRec)),this.fpsMax.textContent=i(s.apply(null,this.fpsRec))}}(l),m=new class{constructor(t,e,s,i){this.game=t,this.canvas=e,this.settings=s,this.monitor=i,this.reset=document.getElementById("reset"),this.pause=document.getElementById("pause"),this.step=document.getElementById("step"),this.play=document.getElementById("play"),this.speed=document.getElementById("speed"),this.speedText=document.getElementById("speed-text"),this.reset.addEventListener("click",(()=>this.onReset())),this.pause.addEventListener("click",(()=>this.onPause())),this.step.addEventListener("click",(()=>this.onStep())),this.play.addEventListener("click",(()=>this.onPlay())),this.speed.addEventListener("input",(t=>this.onSpeed(t))),this.animationId=null,this.animationSpeed=1,this.animationProgress=0,this.onReset()}disable(){this.reset.disabled=!0,this.pause.disabled=!0,this.step.disabled=!0,this.play.disabled=!0,this.stopAnimation()}onReset(){this.reset.disabled=!0,this.pause.disabled=!0,this.step.disabled=!1,this.play.disabled=!1,this.stopAnimation(),this.game.reset(),this.canvas.render(),this.settings.disable(!1),this.monitor.reset()}onPause(){this.reset.disabled=!1,this.pause.disabled=!0,this.step.disabled=!1,this.play.disabled=!1,this.settings.disable(!0),this.stopAnimation()}onStep(){this.reset.disabled=!1,this.pause.disabled=!0,this.step.disabled=!1,this.play.disabled=!1,this.stopAnimation(),this.settings.disable(!0),this.game.tick(),this.canvas.render(),this.monitor.reset()}onPlay(){this.reset.disabled=!1,this.pause.disabled=!1,this.step.disabled=!0,this.play.disabled=!0,this.startAnimation(),this.settings.disable(!0)}onSpeed(t){const e=Number(t.target.value);this.animationSpeed=a[e],this.speedText.textContent=h[e]}startAnimation(){this.animationProgress=0,null==this.animationId&&(this.animationId=window.requestAnimationFrame((()=>this.animate())))}stopAnimation(){null!=this.animationId&&(window.cancelAnimationFrame(this.animationId),this.animationId=null,this.monitor.reset())}animate(){if(this.animationProgress+=this.animationSpeed,this.animationProgress>=1){for(;this.animationProgress>0;)this.animationProgress-=1,this.game.tick();this.canvas.render()}this.monitor.update(),this.animationId=window.requestAnimationFrame((()=>this.animate()))}}(l,o,d,r);d.setPlayer(m)})();